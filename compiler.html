<!DOCTYPE html>
<html lang="fa" dir="rtl" class="light">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>مفسر پایتون آنلاین</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        'vazir': ['Vazirmatn', 'sans-serif']
                    },
                    colors: {
                        primary: {
                            50: '#f0f9ff',
                            100: '#e0f2fe',
                            500: '#0ea5e9',
                            600: '#0284c7',
                            700: '#0369a1'
                        }
                    }
                }
            }
        }
    </script>
    <style>
        .code-editor {
            font-family: 'Courier New', monospace;
            direction: ltr;
            text-align: left;
        }

        .output-area {
            font-family: 'Courier New', monospace;
            direction: ltr;
            text-align: left;
        }

        .loading-spinner {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body class="font-vazir bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100 transition-colors duration-300">
    <!-- Header -->
    <header class="bg-white dark:bg-gray-800 shadow-sm border-b border-gray-200 dark:border-gray-700">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center space-x-4 space-x-reverse">
                    <div class="bg-primary-500 p-2 rounded-lg">
                        <span class="material-icons text-white text-2xl">code</span>
                    </div>
                    <div>
                        <h1 class="text-xl font-semibold text-gray-900 dark:text-white">مفسر پایتون آنلاین</h1>
                        <p class="text-sm text-gray-500 dark:text-gray-400">اجرای کد پایتون در مرورگر</p>
                    </div>
                </div>

                <div class="flex items-center space-x-4 space-x-reverse">
                    <!-- Theme Toggle -->
                    <button id="themeToggle"
                        class="p-2 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors duration-200">
                        <span class="material-icons text-gray-600 dark:text-gray-300" id="themeIcon">dark_mode</span>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- Code Editor Section -->
            <div class="space-y-4">
                <div class="flex items-center justify-between">
                    <h2 class="text-lg font-medium text-gray-900 dark:text-white flex items-center">
                        <span class="material-icons ml-2">edit_note</span>
                        ویرایشگر کد
                    </h2>
                    <div class="flex space-x-2 space-x-reverse">
                        <button id="clearBtn"
                            class="px-3 py-1 text-sm bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-md transition-colors duration-200 flex items-center">
                            <span class="material-icons text-sm ml-1">clear</span>
                            پاک کردن
                        </button>
                        <button id="exampleBtn"
                            class="px-3 py-1 text-sm bg-primary-100 dark:bg-primary-900 hover:bg-primary-200 dark:hover:bg-primary-800 text-primary-700 dark:text-primary-300 rounded-md transition-colors duration-200 flex items-center">
                            <span class="material-icons text-sm ml-1">lightbulb</span>
                            مثال
                        </button>
                    </div>
                </div>

                <div class="relative">
                    <textarea id="codeEditor"
                        class="code-editor w-full h-96 p-4 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 resize-none focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all duration-200"
                        placeholder="کد پایتون خود را اینجا بنویسید..." spellcheck="false"></textarea>
                </div>

                <button id="runBtn"
                    class="w-full bg-primary-500 hover:bg-primary-600 disabled:bg-gray-400 text-white font-medium py-3 px-6 rounded-lg transition-all duration-200 flex items-center justify-center space-x-2 space-x-reverse disabled:cursor-not-allowed">
                    <span class="material-icons" id="runIcon">play_arrow</span>
                    <span id="runText">اجرا (Run)</span>
                </button>
            </div>

            <!-- Output Section -->
            <div class="space-y-4">
                <h2 class="text-lg font-medium text-gray-900 dark:text-white flex items-center">
                    <span class="material-icons ml-2">terminal</span>
                    خروجی
                </h2>

                <div
                    class="bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg overflow-hidden">
                    <div class="bg-gray-50 dark:bg-gray-700 px-4 py-2 border-b border-gray-200 dark:border-gray-600">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-2 space-x-reverse">
                                <div class="w-3 h-3 bg-red-500 rounded-full"></div>
                                <div class="w-3 h-3 bg-yellow-500 rounded-full"></div>
                                <div class="w-3 h-3 bg-green-500 rounded-full"></div>
                            </div>
                            <button id="clearOutputBtn"
                                class="text-xs text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 flex items-center">
                                <span class="material-icons text-sm ml-1">clear</span>
                                پاک کردن خروجی
                            </button>
                        </div>
                    </div>

                    <div id="output"
                        class="output-area p-4 h-96 overflow-y-auto bg-gray-900 text-green-400 font-mono text-sm">
                        <div class="text-gray-500 text-center py-8">
                            <span class="material-icons text-4xl mb-2 block">code</span>
                            خروجی کد شما اینجا نمایش داده می‌شود
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Status Bar -->
        <div class="mt-8 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4 space-x-reverse">
                    <div class="flex items-center space-x-2 space-x-reverse">
                        <div id="statusIndicator" class="w-3 h-3 bg-gray-400 rounded-full"></div>
                        <span id="statusText" class="text-sm text-gray-600 dark:text-gray-400">در حال بارگذاری
                            Pyodide...</span>
                    </div>
                </div>
                <div class="text-xs text-gray-500 dark:text-gray-400">
                    Powered by Pyodide
                </div>
            </div>
        </div>
    </main>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white dark:bg-gray-800 rounded-lg p-8 max-w-sm mx-4 text-center">
            <div
                class="loading-spinner w-8 h-8 border-4 border-primary-500 border-t-transparent rounded-full mx-auto mb-4">
            </div>
            <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-2">بارگذاری Pyodide</h3>
            <p class="text-sm text-gray-600 dark:text-gray-400">لطفاً صبر کنید...</p>
        </div>
    </div>

    <!-- Pyodide Script -->
    <script src="https://cdn.jsdelivr.net/pyodide/v0.24.1/full/pyodide.js"></script>

    <script>
        let pyodide = null;
        let isRunning = false;

        // DOM Elements
        const codeEditor = document.getElementById('codeEditor');
        const runBtn = document.getElementById('runBtn');
        const runIcon = document.getElementById('runIcon');
        const runText = document.getElementById('runText');
        const output = document.getElementById('output');
        const clearBtn = document.getElementById('clearBtn');
        const clearOutputBtn = document.getElementById('clearOutputBtn');
        const exampleBtn = document.getElementById('exampleBtn');
        const themeToggle = document.getElementById('themeToggle');
        const themeIcon = document.getElementById('themeIcon');
        const statusIndicator = document.getElementById('statusIndicator');
        const statusText = document.getElementById('statusText');
        const loadingOverlay = document.getElementById('loadingOverlay');

        // Theme Management
        function initTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.className = savedTheme;
            updateThemeIcon(savedTheme);
        }

        function toggleTheme() {
            const currentTheme = document.documentElement.className;
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            document.documentElement.className = newTheme;
            localStorage.setItem('theme', newTheme);
            updateThemeIcon(newTheme);
        }

        function updateThemeIcon(theme) {
            themeIcon.textContent = theme === 'light' ? 'dark_mode' : 'light_mode';
        }

        // Initialize Pyodide
        async function initPyodide() {
            try {
                statusText.textContent = 'در حال بارگذاری Pyodide...';
                statusIndicator.className = 'w-3 h-3 bg-yellow-500 rounded-full animate-pulse';

                pyodide = await loadPyodide();

                // Setup stdout/stderr capture
                pyodide.runPython(`
import sys
from io import StringIO

class OutputCapture:
    def __init__(self):
        self.stdout = StringIO()
        self.stderr = StringIO()
        self.original_stdout = sys.stdout
        self.original_stderr = sys.stderr
    
    def start_capture(self):
        self.stdout = StringIO()
        self.stderr = StringIO()
        sys.stdout = self.stdout
        sys.stderr = self.stderr
    
    def stop_capture(self):
        sys.stdout = self.original_stdout
        sys.stderr = self.original_stderr
        return self.stdout.getvalue(), self.stderr.getvalue()

output_capture = OutputCapture()
                `);

                statusText.textContent = 'Pyodide آماده است';
                statusIndicator.className = 'w-3 h-3 bg-green-500 rounded-full';
                runBtn.disabled = false;
                loadingOverlay.style.display = 'none';

            } catch (error) {
                statusText.textContent = 'خطا در بارگذاری Pyodide';
                statusIndicator.className = 'w-3 h-3 bg-red-500 rounded-full';
                appendOutput(`خطا در بارگذاری Pyodide: ${error.message}`, 'error');
                loadingOverlay.style.display = 'none';
            }
        }

        // Run Python Code
        async function runPythonCode() {
            if (!pyodide || isRunning) return;

            const code = codeEditor.value.trim();
            if (!code) {
                appendOutput('لطفاً کدی برای اجرا وارد کنید.', 'warning');
                return;
            }

            isRunning = true;
            runBtn.disabled = true;
            runIcon.textContent = 'hourglass_empty';
            runText.textContent = 'در حال اجرا...';

            try {
                // Start capturing output
                pyodide.runPython('output_capture.start_capture()');

                // Run user code
                await pyodide.runPythonAsync(code);

                // Stop capturing and get output
                const result = pyodide.runPython('output_capture.stop_capture()');
                const [stdout, stderr] = result.toJs();

                if (stdout) {
                    appendOutput(stdout, 'success');
                }
                if (stderr) {
                    appendOutput(stderr, 'error');
                }
                if (!stdout && !stderr) {
                    appendOutput('کد با موفقیت اجرا شد (بدون خروجی)', 'info');
                }

            } catch (error) {
                appendOutput(`خطا: ${error.message}`, 'error');
            } finally {
                isRunning = false;
                runBtn.disabled = false;
                runIcon.textContent = 'play_arrow';
                runText.textContent = 'اجرا (Run)';
            }
        }

        // Append Output
        function appendOutput(text, type = 'info') {
            const timestamp = new Date().toLocaleTimeString('fa-IR');
            const colors = {
                success: 'text-green-400',
                error: 'text-red-400',
                warning: 'text-yellow-400',
                info: 'text-blue-400'
            };

            const outputDiv = document.createElement('div');
            outputDiv.className = `mb-2 ${colors[type] || colors.info}`;
            outputDiv.innerHTML = `
                <div class="text-xs text-gray-500 mb-1">[${timestamp}]</div>
                <pre class="whitespace-pre-wrap">${escapeHtml(text)}</pre>
            `;

            // Clear placeholder if it exists
            const placeholder = output.querySelector('.text-gray-500.text-center');
            if (placeholder) {
                placeholder.remove();
            }

            output.appendChild(outputDiv);
            output.scrollTop = output.scrollHeight;
        }

        // Utility Functions
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function clearEditor() {
            codeEditor.value = '';
            codeEditor.focus();
        }

        function clearOutput() {
            output.innerHTML = `
                <div class="text-gray-500 text-center py-8">
                    <span class="material-icons text-4xl mb-2 block">code</span>
                    خروجی کد شما اینجا نمایش داده می‌شود
                </div>
            `;
        }

        function loadExample() {
            const exampleCode = `# مثال: محاسبه فیبوناچی
def fibonacci(n):
    if n <= 1:
        return n
    return fibonacci(n-1) + fibonacci(n-2)

# نمایش 10 عدد اول فیبوناچی
print("دنباله فیبوناچی:")
for i in range(10):
    print(f"F({i}) = {fibonacci(i)}")

# محاسبه مجموع اعداد زوج
numbers = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
even_sum = sum(x for x in numbers if x % 2 == 0)
print(f"\\nمجموع اعداد زوج: {even_sum}")`;

            codeEditor.value = exampleCode;
        }

        // Event Listeners
        themeToggle.addEventListener('click', toggleTheme);
        runBtn.addEventListener('click', runPythonCode);
        clearBtn.addEventListener('click', clearEditor);
        clearOutputBtn.addEventListener('click', clearOutput);
        exampleBtn.addEventListener('click', loadExample);

        // Keyboard shortcuts
        codeEditor.addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.key === 'Enter') {
                e.preventDefault();
                runPythonCode();
            }
            if (e.key === 'Tab') {
                e.preventDefault();
                const start = e.target.selectionStart;
                const end = e.target.selectionEnd;
                e.target.value = e.target.value.substring(0, start) + '    ' + e.target.value.substring(end);
                e.target.selectionStart = e.target.selectionEnd = start + 4;
            }
        });

        // Initialize
        initTheme();
        initPyodide();
    </script>
    <script>(function () { function c() { var b = a.contentDocument || a.contentWindow.document; if (b) { var d = b.createElement('script'); d.innerHTML = "window.__CF$cv$params={r:'96a8da23c3db7d1d',t:'MTc1NDQyMzcyNi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);"; b.getElementsByTagName('head')[0].appendChild(d) } } if (document.body) { var a = document.createElement('iframe'); a.height = 1; a.width = 1; a.style.position = 'absolute'; a.style.top = 0; a.style.left = 0; a.style.border = 'none'; a.style.visibility = 'hidden'; document.body.appendChild(a); if ('loading' !== document.readyState) c(); else if (window.addEventListener) document.addEventListener('DOMContentLoaded', c); else { var e = document.onreadystatechange || function () { }; document.onreadystatechange = function (b) { e(b); 'loading' !== document.readyState && (document.onreadystatechange = e, c()) } } } })();</script>
</body>

</html>